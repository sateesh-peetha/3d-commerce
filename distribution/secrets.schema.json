{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "version": "1.0.0",
    "title": "3D Commerce Secrets Schema",
    "description": "Secret definitions with rotation policies and injection methods - NO ACTUAL SECRETS HERE",
    "warning": "This file defines secret REQUIREMENTS, not actual values. Never commit secrets to code.",
    "secrets": {
        "FIREBASE_API_KEY": {
            "type": "api_key",
            "required": true,
            "description": "Firebase Web API key",
            "rotation": {
                "required": false,
                "notes": "Firebase API keys are restrictable, not typically rotated"
            },
            "exposure": {
                "frontend_safe": true,
                "prefix_required": "NEXT_PUBLIC_"
            }
        },
        "STRIPE_SECRET_KEY": {
            "type": "api_key",
            "required": true,
            "description": "Stripe secret API key for server-side operations",
            "rotation": {
                "required": true,
                "frequency_days": 90,
                "procedure": "Generate new key in Stripe Dashboard, update env, verify, revoke old"
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            }
        },
        "STRIPE_PUBLISHABLE_KEY": {
            "type": "api_key",
            "required": true,
            "description": "Stripe publishable key for client-side",
            "rotation": {
                "required": false
            },
            "exposure": {
                "frontend_safe": true,
                "prefix_required": "NEXT_PUBLIC_"
            }
        },
        "STRIPE_WEBHOOK_SECRET": {
            "type": "webhook_secret",
            "required": true,
            "description": "Stripe webhook signature verification secret",
            "rotation": {
                "required": true,
                "frequency_days": 90,
                "procedure": "Create new webhook in Stripe, update env, verify, delete old"
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            }
        },
        "AI_API_KEY": {
            "type": "api_key",
            "required": false,
            "description": "AI provider API key (Gemini/OpenAI)",
            "rotation": {
                "required": true,
                "frequency_days": 90
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            },
            "fallback": {
                "behavior": "graceful_degradation",
                "message": "AI features unavailable"
            }
        },
        "FIREBASE_SERVICE_ACCOUNT": {
            "type": "service_account_json",
            "required": true,
            "description": "Firebase Admin SDK service account credentials",
            "format": "json_string_or_file_path",
            "rotation": {
                "required": true,
                "frequency_days": 365,
                "procedure": "Generate new key in GCP Console, update env, verify, revoke old"
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            }
        },
        "SESSION_SECRET": {
            "type": "random_string",
            "required": true,
            "description": "Secret for signing session tokens",
            "min_length": 32,
            "rotation": {
                "required": true,
                "frequency_days": 90,
                "procedure": "Generate new random string, update env, existing sessions will invalidate"
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            }
        },
        "ENCRYPTION_KEY": {
            "type": "encryption_key",
            "required": false,
            "description": "Key for encrypting sensitive data at rest",
            "format": "base64_encoded_32_bytes",
            "rotation": {
                "required": true,
                "frequency_days": 365,
                "procedure": "Rotate with key version support, re-encrypt data if needed"
            },
            "exposure": {
                "frontend_safe": false,
                "server_only": true
            }
        }
    },
    "injection_methods": {
        "environment_variables": {
            "description": "Direct environment variable injection",
            "supported": true,
            "production_ready": true,
            "example": "export STRIPE_SECRET_KEY=sk_live_xxx"
        },
        "gcp_secret_manager": {
            "description": "Google Cloud Secret Manager",
            "supported": true,
            "production_ready": true,
            "recommended": true,
            "setup": {
                "project": "${FIREBASE_PROJECT_ID}",
                "access": "Service account needs secretmanager.secretAccessor role"
            }
        },
        "aws_secrets_manager": {
            "description": "AWS Secrets Manager",
            "supported": true,
            "production_ready": true
        },
        "hashicorp_vault": {
            "description": "HashiCorp Vault",
            "supported": true,
            "production_ready": true
        },
        "docker_secrets": {
            "description": "Docker Swarm secrets",
            "supported": true,
            "production_ready": true
        }
    },
    "validation_rules": {
        "no_hardcoding": {
            "description": "Secrets must never appear in source code",
            "enforcement": "pre_commit_hook",
            "patterns_to_reject": [
                "sk_live_",
                "sk_test_",
                "whsec_",
                "AIza",
                "-----BEGIN PRIVATE KEY-----"
            ]
        },
        "no_logging": {
            "description": "Secrets must never appear in logs",
            "enforcement": "runtime_masking"
        },
        "no_frontend_exposure": {
            "description": "Server-only secrets must not be exposed to frontend",
            "enforcement": "build_time_check"
        }
    },
    "rotation_schedule": {
        "quarterly": [
            "STRIPE_SECRET_KEY",
            "STRIPE_WEBHOOK_SECRET",
            "AI_API_KEY",
            "SESSION_SECRET"
        ],
        "annually": [
            "FIREBASE_SERVICE_ACCOUNT",
            "ENCRYPTION_KEY"
        ]
    },
    "emergency_rotation": {
        "trigger": "Suspected compromise",
        "procedure": [
            "1. Generate new secret immediately",
            "2. Deploy to all environments",
            "3. Revoke old secret",
            "4. Audit access logs",
            "5. Report incident"
        ]
    }
}