{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "version": "1.0.0",
    "title": "3D Commerce Environment Variables Schema",
    "description": "Complete environment variable definitions for all deployment modes",
    "environment_categories": {
        "required": {
            "description": "Variables that MUST be set for the application to start",
            "variables": {
                "RUN_MODE": {
                    "type": "string",
                    "enum": [
                        "development",
                        "staging",
                        "production"
                    ],
                    "description": "Deployment environment mode",
                    "example": "production",
                    "default_safe": "development"
                },
                "FIREBASE_PROJECT_ID": {
                    "type": "string",
                    "pattern": "^[a-z][a-z0-9-]{4,28}[a-z0-9]$",
                    "description": "Firebase/GCP project identifier",
                    "example": "my-3dcommerce-prod"
                },
                "FIREBASE_AUTH_DOMAIN": {
                    "type": "string",
                    "pattern": "^[a-z0-9-]+\\.firebaseapp\\.com$",
                    "description": "Firebase Auth domain",
                    "example": "my-3dcommerce-prod.firebaseapp.com"
                },
                "STORAGE_BUCKET": {
                    "type": "string",
                    "pattern": "^[a-z0-9-]+\\.appspot\\.com$",
                    "description": "Cloud Storage bucket",
                    "example": "my-3dcommerce-prod.appspot.com"
                },
                "API_BASE_URL": {
                    "type": "string",
                    "format": "uri",
                    "description": "Base URL for API endpoints",
                    "example": "https://api.3dcommerce.example.com"
                }
            }
        },
        "secrets": {
            "description": "Sensitive variables that must be injected securely",
            "reference": "/distribution/secrets.schema.json",
            "injection_methods": [
                "environment_variable",
                "gcp_secret_manager",
                "aws_secrets_manager",
                "hashicorp_vault"
            ]
        },
        "optional": {
            "description": "Variables with sensible defaults that can be overridden",
            "variables": {
                "LOG_LEVEL": {
                    "type": "string",
                    "enum": [
                        "debug",
                        "info",
                        "warn",
                        "error"
                    ],
                    "description": "Logging verbosity",
                    "default": "info"
                },
                "SENTRY_DSN": {
                    "type": "string",
                    "format": "uri",
                    "description": "Sentry error tracking DSN",
                    "default": null
                },
                "ANALYTICS_ID": {
                    "type": "string",
                    "description": "Google Analytics tracking ID",
                    "default": null
                },
                "CDN_BASE_URL": {
                    "type": "string",
                    "format": "uri",
                    "description": "CDN URL for static assets",
                    "default": null
                },
                "RATE_LIMIT_ENABLED": {
                    "type": "boolean",
                    "description": "Enable rate limiting",
                    "default": true
                },
                "CORS_ORIGINS": {
                    "type": "string",
                    "description": "Comma-separated allowed CORS origins",
                    "default": "*"
                }
            }
        },
        "feature_flags": {
            "description": "Feature toggle variables",
            "variables": {
                "FEATURE_AI_ENABLED": {
                    "type": "boolean",
                    "description": "Enable AI features",
                    "default": true
                },
                "FEATURE_PLUGINS_ENABLED": {
                    "type": "boolean",
                    "description": "Enable plugin system",
                    "default": true
                },
                "FEATURE_MOBILE_API_ENABLED": {
                    "type": "boolean",
                    "description": "Enable mobile API endpoints",
                    "default": true
                }
            }
        }
    },
    "per_environment_overrides": {
        "development": {
            "LOG_LEVEL": "debug",
            "RATE_LIMIT_ENABLED": false,
            "CORS_ORIGINS": "*"
        },
        "staging": {
            "LOG_LEVEL": "info",
            "RATE_LIMIT_ENABLED": true
        },
        "production": {
            "LOG_LEVEL": "warn",
            "RATE_LIMIT_ENABLED": true,
            "CORS_ORIGINS": "must_be_explicit"
        }
    },
    "frontend_exposure": {
        "prefix": "NEXT_PUBLIC_",
        "exposed_variables": [
            "NEXT_PUBLIC_FIREBASE_PROJECT_ID",
            "NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN",
            "NEXT_PUBLIC_API_BASE_URL",
            "NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY",
            "NEXT_PUBLIC_ANALYTICS_ID"
        ],
        "never_expose": [
            "Any variable containing SECRET, KEY, PASSWORD, TOKEN (except publishable)"
        ]
    },
    "validation": {
        "on_startup": {
            "validate_required": true,
            "validate_format": true,
            "fail_on_missing_required": true,
            "warn_on_missing_optional": true
        },
        "error_messages": {
            "pattern": "Environment variable {name} is required but not set",
            "include_docs_link": true
        }
    },
    "documentation": {
        "generate_example_env": true,
        "output_path": "/.env.example",
        "include_comments": true
    }
}